Описание бота.

Используется:
* Postgress для БД
* Spring Data JPA для представления сущностей БД java объектами
* RabbitMQ для взаимодействия между модулями
* Spring Boot Starter web для веб сервисов
* Liquibase для создания таблиц в БД при запуске приложения
* Log4j2 для логгирования
* Selenium для авторризации на сайте (т.к. нет api для проверки авторизации и получения данных пользователя сайта)
* GitHub для хранения версий
* Docker для запуска сервисов в отдельных контейнерах

Основная логика:

Приложение построено на основе микросервисной архитектуры, где отдельные модули взаимодействуют асинхронно 
через RabbitMQ. Основным компонентом системы является Node (Обработчик сообщений), взаимодействие с которым 
начинается через Диспетчер (Dispatcher):
-----------------------------------------------------------------------------------------------------------------
---Dispatcher: Этот модуль выполняет две основные функции:

   Прием и маршрутизация входящих сообщений: Принимает входящие сообщения от пользователей и определяет, в какую 
   очередь RabbitMQ (текст или фото) отправить сообщение для обработки Node.

   Возврат ответов пользователю: Отправляет ответы пользователю. Эти ответы могут быть сгенерированы Node или 
   самим Диспетчером (например, в случае, если Диспетчер определил, что пользователь прислал неподдерживаемый 
   тип файла).

---Node: Node получает сообщения из нескольких источников:

* От пользователей: Через Диспетчера (текст или фото).
* От 1С: Сообщения, содержащие информацию для рассылок пользователям.

Node обрабатывает эти сообщения, генерирует текстовые ответы пользователям (которые отправляются обратно 
Диспетчеру для отправки пользователю), выполняет рассылки на основе сообщений от 1С и решает, какие 
дополнительные действия необходимо предпринять.

Node может отправлять сообщения (DTO) в другие сервисы для выполнения конкретных задач:

---Mail Service: При необходимости, Node отправляет DTO в Mail Service, который формирует письмо с жалобой 
пользователя для отправки администратору, включающее в себя ссылку для удаления данных. Mail Service отправляет 
сформированное письмо администратору.

---REST Service: Node может отправлять DTO в REST Service для:
* Отправки запросов к внешним REST API (например, для проверки баланса пользователя).
* Имитации входа на сайт с использованием данных из DTO для проверки авторизации и получения регистрационных 
данных пользователя (отсутствует прямое API).
* Удаленного удаления данных: REST Service обрабатывает запрос, переданный по ссылке, и удаляет фотографии и 
сообщения пользователя из базы данных.

---Common: Предоставляет код для использования остальными модулями (DTO Entity DAO Enums).

---Shared-db-migrations: Создает необходимые таблицы в БД при запуске

Дополнительные детали и контекст:
Данные (например, фотографии и текст email) временно сохраняются в базе данных для обеспечения надежности 
доставки жалобы.

После отправки жалобы, администратор получает письмо, содержащее ссылку, переход по которой инициирует 
удаление временных данных из базы данных.

Для взаимодействия с веб-сайтом используется Selenium, т.к. отсутствует официальное API для получения 
информации об авторизации и пользователях.

Для асинхронного взаимодействия между модулями используется RabbitMQ.
Каждый модуль (Диспетчер, Node, Mail Service, REST Service) может генерировать и отправлять ответы 
пользователю, если это необходимо.





Подробнее
----------------------------------------------------------------------------------------------
1. Модуль common 
предоставляет код для использования остальными модулями. 

dto 
- Объекты для передачи между модулями

entity 
- Сущности JPA, представляющие строки в таблицах БД

dao 
- интерфейсы репозиториея Spring Data JPA. предоставляющие сущностям из entity стандартные 
методы для работы с ними и некоторые пользовательские методы для работы с ними

enums 
- Списки состояний пользователя и типов запросов к rest 
----------------------------------------------------------------------------------------------

2. Модуль dispatcher 
получает сообщения из телеграм, перенаправляет их в одну из очередей (очередь для текста или 
очередь для фото), которые слушает модуль node и отправки собственных ответов или ответов из 
очереди ответов обратно в телеграм

configuration 
- Создание в модуле очередей rabbitMQ (очередь для текста, очередь для фото, очередь для 
ответов) и конвертора строк формата json в java объекты

controller 
- Получение обновлений от пользователей, отправка ответов пользователям, установка 
отображаемых в интерфейсе бота команд, определение очереди в которую будет отправлено 
сообщениие.

service
- Отправка сообщений в node (текстовая или фото очередь) , получение сообщений из очереди 
ответов

utils
- Cоздание объектов SendMessage, для упрощения отправки ответов пользователям
----------------------------------------------------------------------------------------------

3. Модуль node (основной модуль) 
получает сообщения из dispatcher (очередь для текста или очередь для фото),  получает 
сообщения из 1С (очередь для сообщений из 1с), отправляет ответы в очередь ответов,
отправляет сообщение из 1с списку пользователей из 1с в очередь ответов, ищет
запрашиваемые товары в xml и отправляет отправляет список
найденыных в нем товаров в очередь ответов, отправляет (при необходимости) dto в очередь для 
mail-service или очередь для rest-service, работает с БД.

configuration 
- Cоздание в модуле очередей rabbitMQ (очередь для сообщений из 1С и очередь для ответов в 1С) 
и конвертора строк формата json в java объекты

entity 
- Сущности JPA, представляющие строки в таблицах БД (RawData сохраняем все сообщения в том 
виде как они приходят из телеграм. Потом убрать этот функционал, нужен только на случай если 
будут какие нибудь непонятки что там может придти)

dao 
- интерфейсы репозиториея Spring Data JPA. предоставляющие сущностям из entity стандартные 
методы для работы с ними и некоторые пользовательские методы для работы с ними

exceptions
- Эксепшн унаследованный от рантаймэксепшн, выкидываем при ошибках загрузки фото с сервиса 
телеграм

service
- Обработка пользовательских команд (с учетом состояния пользователя), работа с БД, отправка 
DTO в очередь для mail-service отправка DTO в очередь для rest-service, отправка ответов в 
очередь ответов, отправка ответов в очередь ответов для 1С.

utils
- Создание вариантов ответов пользователю, проверка сообщений на соответствие паттерну команд, 
генерация ответа с прикрепленной кнопкой /help, получение данных необходимых для организации 
рассылки из сообщения из очереди от 1С, скачивание и хранение xml файла со списком товаров
----------------------------------------------------------------------------------------------

4. Модуль mail-service 
отправляет письма на соответствующий e-mail

configuration 
- Cоздание в модуле очереди rabbitMQ (очередь для емайлов) и конвертора строк формата json в 
java объекты

service
- Получение сообщений из соответствующей очереди, отправка письма с данными из полученного dto, 
отправка ответа в очередь ответов.

utils
-  Определение формата (gif, png, jpg...) изображения
----------------------------------------------------------------------------------------------

5. Модуль rest-service 
отправляет http запросы стороннему rest сервису, обрабатывает ответы от стороннего rest 
сервиса и отправляет их в очередь ответов. Отправляет http запросы к сайту, обрабатывает
ответы сайта и отправляет их в очередь ответов, обрабатывает http запросы к rest контроллеру, 
работает с БД.

configuration 
- Cоздание в модуле очереди rabbitMQ (очередь для авторизации) и конвертора строк формата json
в java объекты

controller 
- Обрабатывает http запросы к rest контроллеру.

service
- Получение сообщений из соответствующей очереди, отправка http запроса с данными из 
полученного dto, удаление данных из Бд (параметры удаления данных получены из параметров 
запроса к rest контроллеру), работа с БД (получение параметров из ответа сайта), отправка 
ответа в очередь ответов.

utils
-  Отправка http get запроса к стороннему rest сервису и обработка ответа. Отправка http
post запроса для авторизации на сайте, обработка ответа. Отправка http get запроса для 
получения данных с сайта, обработка ответа.
----------------------------------------------------------------------------------------------

6. Модуль shared-db-migrations
Создает необходимые таблицы в БД при запуске
