<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Информация о пользователе</title>
    <!-- Подключаем Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
<div th:if="${error}">
    <p style="color: red;" th:text="${error}"></p>
</div>
<div th:if="${userData}">
    <h2>Информация о пользователе:</h2>
    <ul>
        <li th:each="entry : ${userData}" th:text="${entry.key} + ': ' + ${entry.value}"></li>
    </ul>
</div>

<!-- JavaScript для обработки initData -->
<script>
    // Проверяем, загружается ли страница в Telegram Web App
    if (window.Telegram && window.Telegram.WebApp) {
        const initData = window.Telegram.WebApp.initData;
        // Редирект ТОЛЬКО если userData НЕ загружено и initData есть
        if (initData && ![[${userData}]]) {
            // Отправляем initData на сервер через редирект с query-параметром
            window.location.href = '/api/redirect?initData=' + encodeURIComponent(initData);
        }
        // Если initData нет, ничего не делаем — ошибка рендерится через Thymeleaf
    } else {
        // Если не в Telegram, ничего не делаем — ошибка рендерится через Thymeleaf
    }
</script>
</body>
</html>
